<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>Welcome, <span id="username"></span></h2>
    <button id="logout-button" class="btn btn-danger">Logout</button>

    <h3 class="mt-4">Click History</h3>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Date</th>
            <th>X Coordinate</th>
            <th>X Coordinate</th>
        </tr>
        </thead>
        <tbody id="click-history">
        <!-- Click history will be populated here -->
        </tbody>
    </table>
</div>

<script>
    // Fetch user info and click history
    function loadUserData() {
        fetch('/auth/user')
            .then(response => response.json())
            .then(user => {
                document.getElementById('username').textContent = user.login;

                // Fetch click history
                fetch('/click-tracker/history?userId=' + user.id)
                    .then(response => response.json())
                    .then(clicks => {
                        const tbody = document.getElementById('click-history');
                        clicks.forEach(click => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                    <td>${click.clickedAt}</td>
                                    <td>${click.xCoordinate}</td>
                                    <td>${click.yCoordinate}</td>
                                `;
                            tbody.appendChild(row);
                        });
                    });
            });
    }

    // Handle logout
    document.getElementById('logout-button').addEventListener('click', function() {
        fetch('/auth/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(() => {
                window.location.href = '/index.html';
            });
    });
    let username = document.cookie
    console.log('user', username)
    document.addEventListener('click', function (event) {
        let coordinateX = event.clientX
        let coordinateY = event.clientY
        if(event){
            fetch('http://localhost:8082/click-tracker/track', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    xCoordinate: coordinateX,
                    yCoordinate: coordinateY,
                    clickedAt: new Date(),
                })
            })
                .then((response)=>{
                    console.log('Cookie', allCookies)
                    console.log(response)
                })
        }
    })

    loadUserData();
</script>
</body>
</html>
